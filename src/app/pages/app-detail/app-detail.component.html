<div class="container">
  <shared-sidebar></shared-sidebar>
  <div class="content">
    <div *ngIf="application; else notFound" class="detail-container">

      <!-- Header -->
      <div class="header-detail">
        <button class="back-btn" (click)="onBack()">Back</button>
        <h2>Application Detail</h2>
      </div>

      <!-- Customer -->
      <section class="detail-card">
        <h3>Customer Information</h3>
        <p><strong>Name:</strong> {{ application.customer.name }}</p>
        <p><strong>Age:</strong> {{ application.customer.age }}</p>
        <p><strong>Job:</strong> {{ application.customer.job }}</p>
        <p><strong>Income:</strong> {{ application.customer.income | currency:'IDR' }}</p>
      </section>

      <!-- Item -->
      <section class="detail-card">
        <h3>Item Information</h3>
        <p><strong>Name:</strong> {{ application.item.name }}</p>
        <p><strong>Type:</strong> {{ application.item.type }}</p>
        <p><strong>Price:</strong> {{ application.item.price | currency:'IDR' }}</p>
      </section>

      <!-- Status -->
      <section class="detail-card">
        <h3>Status</h3>
        <select [(ngModel)]="application.status" class="status-dropdown">
          <option value="Pending">Pending</option>
          <option value="Survey">Survey</option>
          <option value="Approved">Approved</option>
          <option value="Rejected">Rejected</option>
        </select>
      </section>

      <!-- Documents -->
      <section class="detail-card">
        <h3>Documents</h3>
        <ul>
          <li *ngIf="application.documents.ktp">
            <p><strong>KTP:</strong></p>
            <a [href]="getSafePdfUrl(application.documents.ktp)" target="_blank">Lihat KTP</a> |
            <a [href]="getDocumentUrl(application.documents.ktp)" download="ktp">Download</a>
            <div class="preview">
              <img *ngIf="isImage(application.documents.ktp)"
                   [src]="getDocumentUrl(application.documents.ktp)" 
                   alt="KTP Preview">
              <iframe *ngIf="isPdf(application.documents.ktp)"
                      [src]="getSafePdfUrl(application.documents.ktp)"
                      width="100%" height="500px" style="border:none;"></iframe>
            </div>
          </li>

          <li *ngIf="application.documents.kk">
            <p><strong>KK:</strong></p>
            <a [href]="getSafePdfUrl(application.documents.kk)" target="_blank">Lihat KK</a> |
            <a [href]="getDocumentUrl(application.documents.kk)" download="kk">Download</a>
            <div class="preview">
              <img *ngIf="isImage(application.documents.kk)"
                   [src]="getDocumentUrl(application.documents.kk)" 
                   alt="KK Preview">
              <iframe *ngIf="isPdf(application.documents.kk)"
                      [src]="getSafePdfUrl(application.documents.kk)"
                      width="100%" height="500px" style="border:none;"></iframe>
            </div>
          </li>

          <li *ngIf="application.documents.paySlip">
            <p><strong>Slip Gaji:</strong></p>
            <a [href]="getSafePdfUrl(application.documents.paySlip)" target="_blank">Lihat Slip</a> |
            <a [href]="getDocumentUrl(application.documents.paySlip)" download="slip">Download</a>
            <div class="preview">
              <img *ngIf="isImage(application.documents.paySlip)"
                   [src]="getDocumentUrl(application.documents.paySlip)" 
                   alt="Slip Preview">
              <iframe *ngIf="isPdf(application.documents.paySlip)"
                      [src]="getSafePdfUrl(application.documents.paySlip)"
                      width="100%" height="500px" style="border:none;"></iframe>
            </div>
          </li>

          <li *ngIf="application.documents.npwp">
            <p><strong>NPWP:</strong></p>
            <a [href]="getSafePdfUrl(application.documents.npwp)" target="_blank">Lihat NPWP</a> |
            <a [href]="getDocumentUrl(application.documents.npwp)" download="npwp">Download</a>
            <div class="preview">
              <img *ngIf="isImage(application.documents.npwp)"
                   [src]="getDocumentUrl(application.documents.npwp)" 
                   alt="NPWP Preview">
              <iframe *ngIf="isPdf(application.documents.npwp)"
                      [src]="getSafePdfUrl(application.documents.npwp)"
                      width="100%" height="500px" style="border:none;"></iframe>
            </div>
          </li>
        </ul>
      </section>

      <!-- Save -->
      <div class="save-container">
        <button class="save-btn" [disabled]="!isStatusChanged()" (click)="onSave()">Save</button>
      </div>
    </div>

    <ng-template #notFound>
      <p class="not-found">Application not found.</p>
    </ng-template>
  </div>
</div>
